# July 8, 2024 Notes

Today was supposed to be the day for my shareouts, but the power went out in the building for DPI. So now, I'm working from home!

Today, we're starting on the Rails/JavaScript interaction.

## Ian's Corner

Today we're discussing the final project

### Functional Specification

- The project begins with us filling out a functional specification, which we'll send to Ian and a TA

## Rails and JavaScript

Today, we're doing a lot of Ajax methods and using (sigh) jQuery. Before we get to that, let's discuss templating out JavaScript in files that live next to your `html.erb` templates.

### js.erb Files (Deleting)

- You can create `js.erb` files in the same `app/views` directory as the Model you're displaying/controlling
  - These files can host pure JavaScript
- You can call upon these files in your controller by tying them to actions you perform.
  - Ex: Let's say you wanted to delete a comment on a site like photogram.
    - You can delete it using the built-in HTML operations that link_to provides, but you can add a callback to js:
      ```ruby
        def destroy
          @comment.destroy
          respond_to do |format|
            format.html { redirect_back fallback_location: root_url, notice: "Comment was successfully destroyed." }
            format.json { head :no_content }
            format.js do
                render template: "comments/destroy"
            end
          end
        end
      ```
      - Note the `format.js` method we added at the end.
      - Here's the template in question (`destroy.js.erb`):
        `console.log("bye comment!")`
    - We run this, and not only does it destroy the comment, but we also see the message in our browser console

### Rails and JavaScript HTML/jQuery

- So if we wanted to be able to affect specific things in the browser, we can grab it with the classic `getElementById` method, or if we've imported jQuery, we can just use `$(thingName).method`
- So if we wanted to access any comment the user owns for editing or deleting purposes, we could do it this way:
  - `<li id="comment_<%= comment.id %>" class="list-group-item">`
  - or we can use the built-in `dom_id` helper method that rails includes

#### dom_id

- Using `dom_id`, it looks like this:
  - `<li id="<%= dom_id(comment) %>" class="list-group-item">`
  - This method basically returns: `"#{thing.class.to_s.underscore}_#{thing.id}"`
- So this is handy for removing a deleted comment from the DOM when you press the button instead of it needing to update on a refresh

  - To follow through with removing it, we can update our `destroy.js.erb` file:
    `$("#<%= dom_id(@comment) %>").remove();`

    - now, instead of us needing to refresh the DOM to see the comment missing, it disappears instantly thanks to our callback in the controller

      - we can add a lil pizzazz to make it delete more smoothly:

        - ```javascript
          $("#<%= dom_id(@comment) %>").fadeOut(5000, function () {
            $(this).remove();
          });
          ```
          - with this, deleted comments fade out over five seconds

#### Creating with JS instead of HTML in Rails

- We can change the requests our form elements send out from HTML to JS by adding the `local: false` flag to form_withs
  - to wit: `<%= form_with(model: comment, local: false) do |form| %>`
- be SURE you have your format.js in the right coding block, as the autogenerated create method will have an if/else statement

##### Create pt 2: Concise format.js

- you can just type `format.js` in your controller method, as rails will look through your controller and the associated action as long as it follows naming convention.

##### Instantly updating DOM to reflect changes

- So with all that, we can change our `create.js.erb` file to make our creations instantly show up in the DOM
- Here's how it'll look:

  ```javascript
  var added_comment = $(
    "<%= escape_javascript(render 'comments/comment', comment: @comment) %>"
  );

  $("#<%= dom_id(@comment.photo) %>_new_comment_form").before(added_comment);
  ```

  - Note that we're using dom_id(@comment.photo) here so we have an id to grab that doesn't error out as the comment we're creating doesn't technically exist h

###### Rendering Partials with escape_javascript or j

- If you want to quickly render partials in your DOM, you can use the `escape_javascript` helper method to add the partials without having to go through escaping all of the little quirky characters you need to make the partials happen.
- There's an even shorter method than `escape_javascript`, you can just use `j` instead

  - so the snippet above becomes:

    ```javascript
    var added_comment = $(
      "<%= j(render 'comments/comment', comment: @comment) %>"
    );

    $("#<%= dom_id(@comment.photo) %>_new_comment_form").before(added_comment);
    ```

    - if we include the classic `render @comment` abbreviation, it'd be:

      ```javascript
      var added_comment = $("<%= j(render @comment) %>");

      $("#<%= dom_id(@comment.photo) %>_new_comment_form").before(
        added_comment
      );
      ```
